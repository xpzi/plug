<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="keywords" content="映客,映客直播,映客app,映客官网,直播,明星直播,映客下载,映客直播下载,映客app下载,视频交友,全民直播,美女直播,高颜值直播" />
    <meta name="description" content="映客直播,实时、高清、快捷、流畅的视频直播平台,中国全新的视频社交媒体,明星大咖、网络红人、时尚娱乐、高颜值、视频交友等尽在映客直播app" />
    <title>我开放的服务</title>
    <link type="image/x-icon" rel="shortcut icon" href="https://act.inke.cn/common/favicon.ico">
    <script>var rem = { baseRem: 20, baseWidth: 375, rootEle: document.getElementsByTagName("html")[0], initHandle: function() { this.setRemHandle(); this.resizeHandle(); }, setRemHandle: function() { var clientWidth = document.documentElement.clientWidth || document.body.clientWidth; this.rootEle.style.fontSize = clientWidth * this.baseRem / this.baseWidth + "px"; }, resizeHandle: function() { var that = this; window.addEventListener("resize", function() { setTimeout(function() { that.setRemHandle(); }, 300); }); } }; rem.initHandle();</script>
    <link rel="stylesheet" href="css/base.css">
    <style>
        .footer{padding:2rem 0;}
    </style>
</head>
<body>
    <main id="wrapper">
        <p class="title c3">开放服务设置</p>
        <ul class="service desc c2"></ul>
        <footer class="footer">
            <button class="btn-f c4">确定</button>
        </footer>
    </main>

    <!--loading-->
    <section id="loading"><p><span></span></p></section>
    <!--loading结束-->
</body>
<div style="display:none;"><script src="https://s95.cnzz.com/z_stat.php?id=1261919673&web_id=1261919673" language="JavaScript"></script></div>
    <script src="https://act.inke.cn/common/zepto.min.js"></script>
    <script src="js/common-s.js"></script>
    <script src="js/base.js"></script>
    <script>
        var Page = {
            service: $(".service"),
            btn_f: $(".btn-f"),
            init: function () {
                var that = this;
                if (Base.uid && Base.sid) {
                    that.bindEvent();
                    that.initData();
                } else {

                }
            },
            bindEvent: function () {
                var that = this,
                    $this = null;

                that.service.on("click", ".block-f", function () {
                    $this = $(this);
                    that.btn_f.addClass("btn-t").off("click").on("click", function () {
                        that.update();
                    });
                    if ($this.hasClass("block-t")) {
                        $this.removeClass("block-t").attr("data-on", 1);
                    } else {
                        $this.addClass("block-t").attr("data-on", 0);
                    }
                });
            },
            // 查询开放服务
            initData: function () {
                var that = this,
                    _time = new Date() * 1;
                Base.loading.show();

                Common.ajax({
                    host: Base.apiHost(),
                    url: "/app/get_switch_status",
                    data: {
                        v: "201706"
                    },
                    success: function (res) {
                        Base.loading.hide();
                        // console.log("查询开放服务：", res);
                        var data = res.data,
                            dm_error = res.dm_error,
                            error_msg = res.error_msg,
                            _html = "";
                        _czc && _czc.push(["_trackEvent", "economy2_service2", "ajax", "initData_" + dm_error, (new Date() * 1 - _time)]);
                        if (dm_error === 0) {
                            for (var i = 0; i < data.length; i++) {
                                if (data[i].on) {
                                    _html += "<li class=\"block sprites block-f\" data-sid=\"" + data[i].sid + "\" data-on=\"" + data[i].on + "\">" + data[i].name + "</li>";
                                } else {
                                    _html += "<li class=\"block sprites block-f block-t\" data-sid=\"" + data[i].sid + "\" data-on=\"" + data[i].on + "\">" + data[i].name + "</li>";
                                }
                            }
                            that.service.html(_html);
                        } else if (dm_error === 1099010012) {
                            Base.alertShow("登录已过期，请在<br/>设置中退出并重新登录");
                        } else {
                            Base.alertShow(error_msg);
                        }
                    },
                    error: function () {
                        _czc && _czc.push(["_trackEvent", "economy2_service2", "ajax", "initData_error", (new Date() * 1 - _time)]);
                        Base.loading.hide();
                        Base.alertShow("网络错误，请退出重试");
                    }
                });
            },
            // 修改开放服务
            update: function () {
                var that = this,
                    $block_f = $(".block-f"),
                    _data = {},
                    _time = new Date() * 1;
                Base.loading.show();

                for (var i = 0; i < $block_f.length; i++) {
                    _data[$block_f.eq(i).attr("data-sid")] = $block_f.eq(i).attr("data-on")
                }

                Common.ajax({
                    host: Base.apiHost(),
                    url: "/app/update_switch_status",
                    data: {
                        v: "201706",
                        str: JSON.stringify(_data)
                    },
                    success: function (res) {
                        Base.loading.hide();
                        // console.log("修改开放服务：", res);
                        var data = res.data,
                            dm_error = res.dm_error,
                            error_msg = res.error_msg;
                        _czc && _czc.push(["_trackEvent", "economy2_service2", "ajax", "update_" + dm_error, (new Date() * 1 - _time)]);
                        if (dm_error === 0) {
                            Base.alertShow("设置成功", function () {
                                Base.jumpHref("index2.html");
                            });
                            that.btn_f.removeClass("btn-t").off("click");
                        } else if (dm_error === 1099010012) {
                            Base.alertShow("登录已过期，请在<br/>设置中退出并重新登录");
                        } else {
                            Base.alertShow(error_msg);
                        }
                    },
                    error: function () {
                        _czc && _czc.push(["_trackEvent", "economy2_service2", "ajax", "update_error", (new Date() * 1 - _time)]);
                        Base.loading.hide();
                        Base.alertShow("网络错误，请退出重试");
                    }
                });
            },
            log: function (click_id, callback) {  //  埋点
                Common.log({
                    busi_code: "economy2",
                    page_code: "service2",
                    other: {
                        click_id: click_id
                    },
                    callback: callback
                });
            }
        };

        $(function () {
            Page.init();
        });

    </script>
</html>