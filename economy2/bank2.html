<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="keywords" content="映客,映客直播,映客app,映客官网,直播,明星直播,映客下载,映客直播下载,映客app下载,视频交友,全民直播,美女直播,高颜值直播" />
    <meta name="description" content="映客直播,实时、高清、快捷、流畅的视频直播平台,中国全新的视频社交媒体,明星大咖、网络红人、时尚娱乐、高颜值、视频交友等尽在映客直播app" />
    <title>银行账户信息</title>
    <link type="image/x-icon" rel="shortcut icon" href="https://act.inke.cn/common/favicon.ico">
    <script>var rem = { baseRem: 20, baseWidth: 375, rootEle: document.getElementsByTagName("html")[0], initHandle: function() { this.setRemHandle(); this.resizeHandle(); }, setRemHandle: function() { var clientWidth = document.documentElement.clientWidth || document.body.clientWidth; this.rootEle.style.fontSize = clientWidth * this.baseRem / this.baseWidth + "px"; }, resizeHandle: function() { var that = this; window.addEventListener("resize", function() { setTimeout(function() { that.setRemHandle(); }, 300); }); } }; rem.initHandle();</script>
    <link rel="stylesheet" href="css/base.css">
    <style>
        #wrapper{padding-bottom:6.2rem;}
        .main{position:relative;box-sizing:border-box;margin-top:.4rem;width:100%;height:auto;}
        .desc{width:100%;height:auto;}
        li{position:relative;background:#fff;}
        .desc span{display:block;}
        .notice{margin-bottom:1px;}
    </style>
</head>
<body>
    <main id="wrapper">
        <section class="main">
            <ul class="desc c1">
                <li>
                    <p class="block-d block-n">
                        <span class="fl">银行卡号</span>
                        <input id="bcard" class="ipt fr" type="text" placeholder="填写银行卡号" maxlength="30">
                    </p>
                    <p class="notice">注：仅支持借记卡，该卡账号名称必须与实名认证一致</p>
                </li>
                <li class="block block-a">
                    <p class="fl">开户行</p>
                    <p class="fr c3">请选择开户行</p>
                    <select id="bank" class="sel">
                        <option value="请选择开户行">请选择开户行</option>
                        <option value="招商银行">招商银行</option>
                        <option value="中国工商银行">中国工商银行</option>
                        <option value="中国建设银行">中国建设银行</option>
                        <option value="中国农业银行">中国农业银行</option>
                        <option value="中国银行">中国银行</option>
                        <option value="中国民生银行">中国民生银行</option>
                        <option value="中国光大银行">中国光大银行</option>
                        <option value="平安银行">平安银行</option>
                        <option value="交通银行">交通银行</option>
                        <option value="中信银行">中信银行</option>
                        <option value="兴业银行">兴业银行</option>
                        <option value="华夏银行">华夏银行</option>
                        <option value="上海浦东发展银行">上海浦东发展银行</option>
                        <option value="深圳发展银行">深圳发展银行</option>
                        <option value="广东发展银行">广东发展银行</option>
                        <option value="北京银行">北京银行</option>
                        <option value="南京银行">南京银行</option>
                        <option value="上海银行">上海银行</option>
                        <option value="哈尔滨银行">哈尔滨银行</option>
                    </select>
                </li>
                <li class="block">
                    <p class="fl">支行</p>
                    <input id="branch" class="ipt fr" type="text" placeholder="请输入支行" maxlength="50">
                </li>
                <li class="block block-a">
                    <p class="fl">开卡省份</p>
                    <p class="fr c3">请选择开卡省份</p>
                    <select id="cardprovince" class="sel">
                        <option value="请选择开卡省份">请选择开卡省份</option>
                    </select>
                </li>
                <li class="block block-a">
                    <p class="fl">开卡所在市</p>
                    <p class="fr c3">请选择开卡所在市</p>
                    <select id="cardcity" class="sel">
                        <option value="请选择开卡所在市">请选择开卡所在市</option>
                    </select>
                </li>
            </ul>
        </section>
    </main>

    <!--loading-->
    <section id="loading"><p><span></span></p></section>
    <!--loading结束-->
</body>
<div style="display:none;"><script src="https://s95.cnzz.com/z_stat.php?id=1261919673&web_id=1261919673" language="JavaScript"></script></div>
    <script src="https://act.inke.cn/common/zepto.min.js"></script>
    <script src="js/common-s.js"></script>
    <script src="js/base.js"></script>
    <script>
        var Page = {
            btn_f: $(".btn-f"),
            bcard: $("#bcard"),
            bank: $("#bank"),
            branch: $("#branch"),
            cardprovince: $("#cardprovince"),
            cardcity: $("#cardcity"),
            init: function () {
                var that = this;
                if (Base.uid && Base.sid) {
                    that.bindEvent();
                    that.initData();
                } else {

                }
            },
            bindEvent: function () {
                var that = this,
                    $this = null;
                Base.selFun();

                that.bcard.on("input", function () {
                    $this = $(this);
                    $this.val($this.val().replace(/(\d{4})(?=\d)/g, "$1 "));
                });

            },
            // 查询银行账号信息
            initData: function () {
                var that = this,
                    _time = new Date() * 1;
                Base.loading.show();

                Common.ajax({
                    host: Base.apiHost(),
                    url: "/app/insert_bank_info",
                    data: {
                        v: "201706",
                        type: 1
                    },
                    success: function (res) {
                        Base.loading.hide();
                        // console.log("查询银行账号信息：", res);
                        var data = res.data,
                            dm_error = res.dm_error,
                            error_msg = res.error_msg;
                        _czc && _czc.push(["_trackEvent", "economy2_bank2", "ajax", "initData_" + dm_error, (new Date() * 1 - _time)]);
                        if (dm_error === 0) {
                            if (data) {
                                that.bcard.val(data.bcard.replace(/(\d{4})(?=\d)/g, "$1 "));
                                that.bank.val(data.bank);
                                that.bank.prev().html(data.bank).removeClass("c3");
                                that.branch.val(data.branch);
                                that.getProvinceCity(data.cardprovince, data.cardcity, data.status);
                                if (data.status === 0 || data.status === 3) {
                                    Base.disabled();
                                    that.btn_f.off("click").removeClass("btn-t");
                                    // that.bank.prev().addClass("c3");
                                } else {
                                    Common.rightButton.initRightButton({
                                        text: "完成",
                                        callback: function () {
                                            that.saveBankMsg();
                                        }
                                    });
                                }
                            } else {
                                that.getProvinceCity();
                                Common.rightButton.initRightButton({
                                    text: "完成",
                                    callback: function () {
                                        that.saveBankMsg();
                                    }
                                });
                            }
                        } else if (dm_error === 1099010012) {
                            Base.alertShow("登录已过期，请在<br/>设置中退出并重新登录");
                        } else if (dm_error === 1099010015) {
                            Base.alertShow(error_msg);
                        } else {
                            Base.alertShow(error_msg);
                        }
                    },
                    error: function () {
                        _czc && _czc.push(["_trackEvent", "economy2_bank2", "ajax", "initData_error", (new Date() * 1 - _time)]);
                        Base.loading.hide();
                        Base.alertShow("网络错误，请退出重试");
                    }
                });
            },
            // 省市二级联动
            getProvinceCity: function (province, city, status) {
                var that = this,
                    $this = null,
                    $province = $("#cardprovince"),
                    $city = $("#cardcity"),
                    _provincesHtml = "<option value=\"请选择开卡省份\">请选择开卡省份</option>",
                    _cityHtml = "<option value=\"请选择开卡所在市\">请选择开卡所在市</option>",
                    _val = "",
                    _item = "",
                    _time = new Date() * 1;
                Base.loading.show();

                // 省市二级联动数据
                Common.ajax({
                    url: "https://actapi.busi.inke.cn/largecash/provinces_city",
                    data: {
                        uid: that.uid,
                        sid: that.sid
                    },
                    success: function (res) {
                        Base.loading.hide();
                        var data = res.data,
                            dm_error = res.dm_error,
                            error_msg = res.error_msg;
                        _czc && _czc.push(["_trackEvent", "economy2_bank2", "ajax", "getProvinceCity_" + dm_error, (new Date() * 1 - _time)]);
                        if (dm_error === 0) {
                            for (var i in data) {
                                _provincesHtml += "<option value=\"" + i + "\">" + i + "</option>";
                            }
                            $province.html(_provincesHtml).on("change", function () {
                                $this = $(this);
                                _val = $this.val();
                                _cityHtml = "<option value=\"请选择开卡所在市\">请选择开卡所在市</option>";
                                if (_val !== "请选择开卡省份") {
                                    _item = data[_val];
                                    for (var j = 0; j < _item.length; j++) {
                                        _cityHtml += "<option value=\"" + _item[j].name + "\">" + _item[j].name + "</option>";
                                    }
                                }
                                $city.html(_cityHtml);
                                $city.prev().html("请选择开卡所在市").addClass("c3");
                            });

                            if (province && city) {
                                for (var j = 0; j < data[province].length; j++) {
                                    _cityHtml += "<option value=\"" + data[province][j].name + "\">" + data[province][j].name + "</option>";
                                }
                                $city.html(_cityHtml);
                                that.cardprovince.val(province);
                                that.cardprovince.prev().html(province).removeClass("c3");
                                that.cardcity.val(city);
                                that.cardcity.prev().html(city).removeClass("c3");
//                                if (status === 0 || status === 3) {
//                                    that.cardprovince.prev().addClass("c3");
//                                    that.cardcity.prev().addClass("c3");
//                                }
                            }
                        } else if (dm_error === 1099010011) {
                            Base.alertShow("登录已过期，请在<br/>设置中退出并重新登录");
                        } else {
                            Base.alertShow(error_msg);
                        }
                    },
                    error: function () {
                        _czc && _czc.push(["_trackEvent", "economy2_bank2", "ajax", "getProvinceCity_error", (new Date() * 1 - _time)]);
                        Base.loading.hide();
                        Base.alertShow("网络错误，请退出重试");
                    }
                });
            },
            // 存储银行账号信息
            saveBankMsg: function () {
                var that = this,
                    _time = new Date() * 1,
                    _bcard = that.bcard.val().trim().replace(/\s/g, ""),
                    _bank = that.bank.val(),
                    _branch = that.branch.val().trim(),
                    _cardprovince = that.cardprovince.val(),
                    _cardcity = that.cardcity.val();

                if (_bank.indexOf("请选择") >= 0 || _cardprovince.indexOf("请选择") >= 0 || _cardcity.indexOf("请选择") >= 0) {
                    Base.alertShow("请填写完整的银行账号信息");
                    return;
                }

                if (!/^\d{16,24}$/.test(_bcard)) {
                    Base.alertShow("请填写正确的银行卡号");
                    return;
                }

                if (!_branch) {
                    Base.alertShow("请填写正确的支行");
                    return;
                }

                Base.loading.show();
                Common.ajax({
                    host: Base.apiHost(),
                    url: "/app/insert_bank_info",
                    data: {
                        v: "201706",
                        type: 2,
                        bcard: _bcard,
                        bank: _bank,
                        branch: _branch,
                        cardprovince: _cardprovince,
                        cardcity: _cardcity
                    },
                    success: function (res) {
                        Base.loading.hide();
                        // console.log("存储银行账号信息：", res);
                        var data = res.data,
                            dm_error = res.dm_error,
                            error_msg = res.error_msg;
                        _czc && _czc.push(["_trackEvent", "economy2_bank2", "ajax", "saveBankMsg_" + dm_error, (new Date() * 1 - _time)]);

                        if (dm_error === 0) {
                            Base.confirm("请到完善资料页提交申请信息", function () {
                                window.setTimeout(function () {
                                    Base.jumpHref("data2.html");
                                }, 300);
                            });
                        } else if (dm_error === 1099010012) {
                            Base.alertShow("登录已过期，请在<br/>设置中退出并重新登录");
                        } else if (dm_error === 1099010015) {
                            Base.alertShow(error_msg);
                        } else {
                            Base.alertShow(error_msg);
                        }
                    },
                    error: function () {
                        _czc && _czc.push(["_trackEvent", "economy2_bank2", "ajax", "saveBankMsg_error", (new Date() * 1 - _time)]);
                        Base.loading.hide();
                        Base.alertShow("网络错误，请退出重试");
                    }
                });
            },
            log: function (click_id, callback) {  //  埋点
                Common.log({
                    busi_code: "economy2",
                    page_code: "bank2",
                    other: {
                        click_id: click_id
                    },
                    callback: callback
                });
            }
        };

        $(function () {
            Page.init();
        });

    </script>
</html>